<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IntroHater - Leaderboard</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Space+Grotesk:wght@500;700&display=swap"
        rel="stylesheet">

    <!-- Styles -->
    <link rel="stylesheet" href="css/style.css?v=2">

</head>

<body>

    <!-- Header -->
    <header>
        <div class="container">
            <a href="/" class="logo text-gradient">
                <img src="icon32.png" alt="Logo">
                IntroHater
            </a>
            <nav>
                <ul class="nav-links">
                    <li><a href="index.html">Home</a></li>
                    <li><a href="catalog.html">Catalog</a></li>
                    <li><a href="leaderboard.html" class="active">Leaderboard</a></li>
                    <li><a href="community.html">Community</a></li>
                    <li><a href="https://github.com/introhaterapp/IntroHater" target="_blank">GitHub</a></li>
                </ul>
            </nav>
            <div class="header-actions">
                <a href="configure.html" class="btn btn-primary" style="padding: 8px 16px; font-size: 0.85rem;">Install
                    Addon</a>
            </div>
        </div>
    </header>

    <main>
        <section class="section">
            <div class="container hero-container text-center">
                <div class="header-content reveal-on-scroll">
                    <h1 class="hero-title reveal-on-scroll">Top <span class="text-gradient-primary">Contributors</span>
                    </h1>
                    <p class="hero-subtitle reveal-on-scroll">
                        The heroes making streaming smooth for everyone.
                    </p>

                </div>

                <div class="tabs-premium reveal-on-scroll"
                    style="max-width: 600px; margin-left: auto; margin-right: auto;">
                    <div id="tab-indicator" class="tab-indicator"></div>
                    <button class="tab-btn-premium active" data-tab="segments">Most Segments</button>
                    <button class="tab-btn-premium" data-tab="votes">Most Votes</button>
                    <button class="tab-btn-premium" data-tab="saved">Most Time Saved</button>
                </div>

                <div class="glass-panel text-center reveal-on-scroll" style="overflow: hidden;">
                    <div class="table-container" style="margin-top: 0;">
                        <table class="leaderboard-table">
                            <thead>
                                <tr>
                                    <th style="width: 100px; text-align: center;">Rank</th>
                                    <th>User</th>
                                    <th style="text-align: right;">Segments</th>
                                    <th style="text-align: right;">Votes</th>
                                    <th style="text-align: right;">Time Saved</th>
                                </tr>
                            </thead>
                            <tbody id="leaderboard-body">
                                <tr>
                                    <td colspan="4" style="text-align: center; padding: 40px;">Loading data...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <p
                        style="font-size: 0.85rem; color: var(--text-dim); padding: 15px; border-top: 1px solid rgba(255,255,255,0.05); margin: 0;">
                        Last updated: <span id="update-time">Loading...</span>
                    </p>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-bottom" style="text-align: center; color: var(--text-muted); font-size: 0.85rem;">
                <p>&copy; 2024 IntroHater. Thank you to all contributors!</p>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="js/main.js"></script>
    <script>
        let currentTab = 'segments';
        let leaderboardData = null;

        async function fetchLeaderboardData() {
            try {
                // Use relative URL to fetch from current instance
                const response = await fetch(`${API_BASE_URL}/api/leaderboard`);
                if (!response.ok) throw new Error('Failed to fetch');
                const data = await response.json();
                leaderboardData = data;
                updateLastUpdated(data.lastUpdated);
                displayLeaderboard(currentTab);
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('leaderboard-body').innerHTML = `
                    <tr><td colspan="4" style="text-align: center; padding: 40px;">Failed to load data.</td></tr>
                `;
            }
        }

        function updateLastUpdated(timestamp) {
            const date = timestamp ? new Date(timestamp) : new Date();
            document.getElementById('update-time').textContent = date.toLocaleString();
        }

        function formatDuration(seconds) {
            if (!seconds) return '0s';
            if (seconds < 60) return Math.round(seconds) + 's';
            if (seconds < 3600) return Math.round(seconds / 60) + 'm';
            return (seconds / 3600).toFixed(1) + 'h';
        }

        function displayLeaderboard(type) {
            if (!leaderboardData?.users) return;

            const tbody = document.getElementById('leaderboard-body');
            const users = [...leaderboardData.users];

            users.sort((a, b) => {
                if (type === 'segments') return (b.segments || 0) - (a.segments || 0);
                if (type === 'votes') return (b.votes || 0) - (a.votes || 0);
                if (type === 'saved') return (b.savedTime || 0) - (a.savedTime || 0);
                return 0;
            });

            tbody.innerHTML = users.slice(0, 50).map((user, index) => {
                let rankClass = '';
                if (index === 0) rankClass = 'rank-1';
                if (index === 1) rankClass = 'rank-2';
                if (index === 2) rankClass = 'rank-3';

                return `
                <tr>
                    <td style="text-align: center; font-weight: 700; font-size: 1.2rem;" class="${rankClass}">#${index + 1}</td>
                    <td><span class="user-cell" title="${user.userId}">${(user.userId || 'Unknown').substring(0, 8)}</span></td>
                    <td style="text-align: right; font-weight: 600;">${(user.segments || 0).toLocaleString()}</td>
                    <td style="text-align: right; font-weight: 600;">${(user.votes || 0).toLocaleString()}</td>
                    <td style="text-align: right; font-weight: 600;">${formatDuration(user.savedTime || 0)}</td>
                </tr>
                `;
            }).join('');
        }

        function updateTabIndicator() {
            const activeBtn = document.querySelector('.tab-btn-premium.active');
            const indicator = document.getElementById('tab-indicator');
            if (activeBtn && indicator) {
                indicator.style.width = `${activeBtn.offsetWidth}px`;
                indicator.style.left = `${activeBtn.offsetLeft}px`;
            }
        }

        document.querySelectorAll('.tab-btn-premium').forEach(btn => {
            btn.addEventListener('click', (e) => {
                document.querySelectorAll('.tab-btn-premium').forEach(b => b.classList.remove('active'));
                e.target.classList.add('active');
                currentTab = e.target.dataset.tab;
                displayLeaderboard(currentTab);
                updateTabIndicator();
            });
        });

        window.addEventListener('resize', updateTabIndicator);
        setTimeout(updateTabIndicator, 100);

        // Initialize
        document.addEventListener('DOMContentLoaded', fetchLeaderboardData);
    </script>

</body>

</html>